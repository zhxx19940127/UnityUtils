# Unity AssetBundle æ‰“åŒ…å·¥å…·ç³»ç»Ÿ

ä¸€ä¸ªå®Œæ•´çš„ Unity AssetBundle æ‰“åŒ…ã€åŠ è½½å’Œç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¯è§†åŒ–æ“ä½œã€æ¨¡å‹é€‰æ‹©ã€Shader è‡ªåŠ¨ç®¡ç†å’Œ WebGL å¹³å°ä¼˜åŒ–ã€‚

---

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è¯¦ç»†ä½¿ç”¨æŒ‡å—](#è¯¦ç»†ä½¿ç”¨æŒ‡å—)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [Shader å˜ä½“ç®¡ç†](#shader-å˜ä½“ç®¡ç†)
- [æ‰“åŒ…è¾“å‡ºè¯´æ˜](#æ‰“åŒ…è¾“å‡ºè¯´æ˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

### æ¶æ„ç»„æˆ

```
AssetBundleTools/
â”œâ”€â”€ Editor/
â”‚   â””â”€â”€ AssetBundleBuilderWindow.cs    # å¯è§†åŒ–æ‰“åŒ…å·¥å…·é¢æ¿
â”œâ”€â”€ AssetBundleManager.cs              # AB åŒ…åŠ è½½ç®¡ç†å™¨ï¼ˆè¿è¡Œæ—¶ï¼‰
â”œâ”€â”€ AssetBundleConfig.cs               # AB åŒ…é…ç½®ç±»ï¼ˆè¿è¡Œæ—¶ï¼‰
â””â”€â”€ README.md                          # æœ¬æ–‡æ¡£
```

### æ ¸å¿ƒç‰¹æ€§

âœ… **å¯è§†åŒ–æ‰“åŒ…é¢æ¿** - æ— éœ€å†™ä»£ç ï¼Œæ‹–æ‹½é…ç½®å³å¯å®Œæˆæ‰“åŒ…  
âœ… **æ¨¡å‹é€‰æ‹©æ‰“åŒ…** - æ”¯æŒå•ç‹¬é€‰æ‹©éƒ¨åˆ†æ¨¡å‹æ‰“åŒ…ï¼ŒèŠ‚çœæ—¶é—´  
âœ… **æ™ºèƒ½å…±äº«èµ„æº** - è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†æè´¨ã€çº¹ç†ç­‰å…±äº«ä¾èµ–  
âœ… **Shader è‡ªåŠ¨ç®¡ç†** - è‡ªåŠ¨æ”¶é›†å¹¶æ·»åŠ  Shader åˆ° Always Included Shaders  
âœ… **WebGL ä¼˜åŒ–** - é’ˆå¯¹ WebGL å¹³å°çš„åŠ è½½ä¼˜åŒ–å’Œå¹¶å‘æ§åˆ¶  
âœ… **è¿è¡Œæ—¶åŠ è½½** - é«˜æ•ˆçš„ AB åŒ…åŠ è½½ã€ç¼“å­˜å’Œå¸è½½ç®¡ç†  
âœ… **ä¾èµ–ç®¡ç†** - è‡ªåŠ¨å¤„ç† AB åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»  
âœ… **é…ç½®æŒä¹…åŒ–** - æ‰€æœ‰è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼Œé‡æ–°æ‰“å¼€é¢æ¿ä¿æŒä¸Šæ¬¡é…ç½®

---

## ç³»ç»Ÿç»„ä»¶è¯´æ˜

### 1. AssetBundleBuilderWindow.csï¼ˆç¼–è¾‘å™¨å·¥å…·ï¼‰

**ä½ç½®**ï¼š`Assets/AssetBundleTools/Editor/`

**åŠŸèƒ½**ï¼šå¯è§†åŒ–æ‰“åŒ…å·¥å…·é¢æ¿

**ä¸»è¦ç‰¹æ€§**ï¼š
- æ‹–æ‹½è®¾ç½®è·¯å¾„é…ç½®
- æ¨¡å‹åˆ—è¡¨æ˜¾ç¤ºä¸é€‰æ‹©
- Shader è‡ªåŠ¨æ£€æµ‹ä¸ç®¡ç†
- å¤šå¹³å°æ„å»ºæ”¯æŒ
- é«˜çº§æ„å»ºé€‰é¡¹é…ç½®
- AB åŒ…å¤åˆ¶åˆ°å¤–éƒ¨è·¯å¾„

### 2. AssetBundleManager.csï¼ˆè¿è¡Œæ—¶ï¼‰

**ä½ç½®**ï¼š`Assets/AssetBundleTools/`

**åŠŸèƒ½**ï¼šAB åŒ…è¿è¡Œæ—¶åŠ è½½ç®¡ç†å™¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰

**ä¸»è¦ç‰¹æ€§**ï¼š
- è‡ªåŠ¨åˆå§‹åŒ–å’Œé…ç½®åŠ è½½
- å¼‚æ­¥/åŒæ­¥èµ„æºåŠ è½½
- ä¾èµ–è‡ªåŠ¨ç®¡ç†
- WebGL å¹¶å‘æ§åˆ¶
- å†…å­˜ç¼“å­˜ä¼˜åŒ–
- æ‰‹åŠ¨å¸è½½æ”¯æŒ

### 3. AssetBundleConfig.csï¼ˆè¿è¡Œæ—¶ï¼‰

**ä½ç½®**ï¼š`Assets/AssetBundleTools/`

**åŠŸèƒ½**ï¼šAB åŒ…é…ç½®å’Œè·¯å¾„ç®¡ç†

**ä¸»è¦ç‰¹æ€§**ï¼š
- è·¨å¹³å°è·¯å¾„å¤„ç†
- é…ç½®æ–‡ä»¶è¯»å–
- è·¯å¾„å·¥å…·æ–¹æ³•

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. AssetBundle æ‰“åŒ…å·¥å…·é¢æ¿

é€šè¿‡èœå• `AssetBundle â†’ æ‰“åŒ…å·¥å…·é¢æ¿` æ‰“å¼€å¯è§†åŒ–æ“ä½œç•Œé¢ã€‚

#### åŠŸèƒ½æ¨¡å—

#### ğŸ“ è·¯å¾„é…ç½®
- **ABåŒ…è¾“å‡ºè·¯å¾„**ï¼šæ‹–æ‹½æˆ–æ‰‹åŠ¨è®¾ç½®è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼š`Assets/StreamingAssets/AssetBundles`ï¼‰
- **æ¨¡å‹æ–‡ä»¶å¤¹è·¯å¾„**ï¼šæ‹–æ‹½æˆ–æ‰‹åŠ¨è®¾ç½®æ¨¡å‹æºæ–‡ä»¶å¤¹ï¼ˆé»˜è®¤ï¼š`Assets/Models`ï¼‰
- å¿«æ·æŒ‰é’®ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ã€æ‰“å¼€æ–‡ä»¶å¤¹

#### ğŸ“‹ æ¨¡å‹é€‰æ‹©åˆ—è¡¨
- æ˜¾ç¤ºæ‰€æœ‰å¾…æ‰“åŒ…çš„æ¨¡å‹é¢„åˆ¶ä½“
- æ”¯æŒå…¨é€‰/å–æ¶ˆå…¨é€‰/åé€‰æ“ä½œ
- å®æ—¶ç»Ÿè®¡ï¼šå…± X ä¸ªæ¨¡å‹ï¼Œå·²é€‰ä¸­ X ä¸ª
- æ¯ä¸ªæ¨¡å‹æ˜¾ç¤ºå¯¹åº”çš„ AB åŒ…åç§°

#### ğŸ¨ Shader æ£€æµ‹ä¸ç®¡ç†
- **æ„å»ºæ—¶è‡ªåŠ¨æ£€æµ‹ Shader**ï¼šå¼€å…³æ§åˆ¶ï¼ˆé»˜è®¤å¼€å¯ï¼‰
- **æ£€æµ‹æ¨¡å‹ Shader**ï¼šæ‰‹åŠ¨æ‰«ææ‰€æœ‰æ¨¡å‹ä½¿ç”¨çš„ Shader
- **è‡ªåŠ¨æ·»åŠ åˆ°åˆ—è¡¨**ï¼šä¸€é”®æ·»åŠ æ‰€æœ‰ Shader åˆ° Always Included Shaders
- æ™ºèƒ½åŒºåˆ†ï¼šè‡ªå®šä¹‰ Shader å’Œ Unity å†…ç½® Shader
- é˜²æ­¢ä¸¢å¤±ï¼šç¡®ä¿ AB åŒ…ä¸­çš„ Shader æ­£ç¡®æ‰“åŒ…

#### âš™ï¸ é«˜çº§æ„å»ºé€‰é¡¹
- **ç›®æ ‡å¹³å°**ï¼šWebGL / PC / Android / iOS ç­‰
- **å‹ç¼©é€‰é¡¹**ï¼š
  - Chunk å‹ç¼© (LZ4) - æ¨èï¼Œå¿«é€Ÿè§£å‹
  - ä¸¥æ ¼æ¨¡å¼ - æ£€æµ‹æ‰“åŒ…é”™è¯¯
  - å¼ºåˆ¶é‡æ–°æ„å»º - å¿½ç•¥ç¼“å­˜å…¨éƒ¨é‡å»º

#### ğŸ”¨ æ„å»ºæ“ä½œ
- **æ„å»ºæ‰€æœ‰æ¨¡å‹åŒ…**ï¼šæ‰“åŒ…æ‰€æœ‰æ¨¡å‹åŠå…±äº«èµ„æº
- **æ„å»ºé€‰ä¸­æ¨¡å‹åŒ… (X)**ï¼šåªæ‰“åŒ…é€‰ä¸­çš„æ¨¡å‹åŠå…±äº«èµ„æº
- **æ ‡è®°æ¨¡å‹**ï¼šæ‰‹åŠ¨æ ‡è®° AB åŒ…åç§°
- **æ£€æµ‹å…±äº«èµ„æº**ï¼šæ‰«ææè´¨ã€çº¹ç†ç­‰å…±äº«ä¾èµ–
- **æ¸…é™¤æ ‡è®°**ï¼šæ¸…é™¤æ‰€æœ‰ AB åŒ…æ ‡è®°
- **ç”Ÿæˆé…ç½®æ–‡ä»¶**ï¼šç”Ÿæˆ AssetBundleConfig.json

#### ğŸ“¦ å¤åˆ¶ AB åŒ…
- è®¾ç½®ç›®æ ‡è·¯å¾„ï¼ˆæ”¯æŒé¡¹ç›®å¤–è·¯å¾„ï¼‰
- ä¸€é”®å¤åˆ¶ AB åŒ…åˆ°æŒ‡å®šä½ç½®ï¼ˆå¦‚ Web æœåŠ¡å™¨ç›®å½•ï¼‰

#### ğŸ› ï¸ å·¥å…·
- **æ¸…ç†è¾“å‡ºæ–‡ä»¶å¤¹**ï¼šåˆ é™¤æ‰€æœ‰å·²ç”Ÿæˆçš„ AB åŒ…
- **æ‰“å¼€ AB Browser**ï¼šæ‰“å¼€ AssetBundle Browserï¼ˆéœ€å®‰è£…ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1ï¼šå‡†å¤‡æ¨¡å‹

1. åœ¨ `Assets/Models/` æ–‡ä»¶å¤¹ä¸­æ”¾å…¥ä½ çš„æ¨¡å‹é¢„åˆ¶ä½“ï¼ˆPrefabï¼‰
2. ç¡®ä¿æ¯ä¸ªé¢„åˆ¶ä½“å·²ç»é…ç½®å¥½æè´¨å’Œçº¹ç†

### æ­¥éª¤ 2ï¼šæ‰“å¼€æ‰“åŒ…é¢æ¿

èœå•ï¼š`AssetBundle â†’ æ‰“åŒ…å·¥å…·é¢æ¿`

### æ­¥éª¤ 3ï¼šé…ç½®è·¯å¾„

- å°† `Assets/Models` æ–‡ä»¶å¤¹æ‹–å…¥"æ¨¡å‹æ–‡ä»¶å¤¹è·¯å¾„"åŒºåŸŸ
- ä¿æŒé»˜è®¤è¾“å‡ºè·¯å¾„ `Assets/StreamingAssets/AssetBundles`

### æ­¥éª¤ 4ï¼šé€‰æ‹©æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

- åœ¨"æ¨¡å‹é€‰æ‹©åˆ—è¡¨"ä¸­å‹¾é€‰éœ€è¦æ‰“åŒ…çš„æ¨¡å‹
- æˆ–ç‚¹å‡»"å…¨é€‰"æ‰“åŒ…æ‰€æœ‰æ¨¡å‹

### æ­¥éª¤ 5ï¼šæ„å»º AB åŒ…

ç‚¹å‡» **"æ„å»ºæ‰€æœ‰æ¨¡å‹åŒ…"** æˆ– **"æ„å»ºé€‰ä¸­æ¨¡å‹åŒ…"** æŒ‰é’®

### æ­¥éª¤ 6ï¼šä½¿ç”¨ AssetBundleManager åŠ è½½

```csharp
using UnityEngine;
using System.Collections;

public class ModelLoader : MonoBehaviour
{
    void Start()
    {
        // åˆå§‹åŒ–å¹¶åŠ è½½æ¨¡å‹
        StartCoroutine(LoadModel());
    }
    
    IEnumerator LoadModel()
    {
        // 1. åˆå§‹åŒ–ç®¡ç†å™¨ï¼ˆä¼šè‡ªåŠ¨åŠ è½½é…ç½®å’Œæ¸…å•ï¼‰
        yield return AssetBundleManager.Instance.Initialize(
            configData => {
                Debug.Log("AB ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ");
            },
            () => {
                Debug.Log("æ‰€æœ‰æ¨¡å‹åŠ è½½å®Œæˆ");
            }
        );
        
        // 2. åŠ è½½æŒ‡å®šæ¨¡å‹
        yield return AssetBundleManager.Instance.LoadAssetAsync<GameObject>(
            "model_ç½.ab",  // AB åŒ…åç§°
            "ç½",            // èµ„æºåç§°
            (obj) => {
                if (obj != null)
                {
                    GameObject model = Instantiate(obj);
                    Debug.Log($"æ¨¡å‹åŠ è½½æˆåŠŸ: {obj.name}");
                }
            }
        );
    }
}
```

---

## è¯¦ç»†ä½¿ç”¨æŒ‡å—

### æ‰“åŒ…è§„åˆ™

#### AB åŒ…å‘½åè§„åˆ™

- **æ¨¡å‹åŒ…**ï¼š`model_{æ–‡ä»¶å}.ab`
  - ç¤ºä¾‹ï¼š`ç½.prefab` â†’ `model_ç½.ab`
  - ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼š
    - `.` â†’ `-`ï¼ˆç‚¹å·æ”¹ä¸ºæ¨ªæ ï¼‰
    - ` ` â†’ `_`ï¼ˆç©ºæ ¼æ”¹ä¸ºä¸‹åˆ’çº¿ï¼‰
    - `&` â†’ `_`ï¼ˆ& ç¬¦å·æ”¹ä¸ºä¸‹åˆ’çº¿ï¼‰

- **å…±äº«èµ„æºåŒ…**ï¼š`shared_common.ab`
  - åŒ…å«è¢«å¤šä¸ªæ¨¡å‹å…±äº«çš„æè´¨ã€çº¹ç†ã€Mesh ç­‰

- **ä¸»æ¸…å•**ï¼š`AssetBundles` å’Œ `AssetBundles.ab`
  - åŒ…å«æ‰€æœ‰ AB åŒ…çš„ä¾èµ–å…³ç³»ä¿¡æ¯

#### å…±äº«èµ„æºæ£€æµ‹é€»è¾‘

ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰æ¨¡å‹çš„ä¾èµ–ï¼š

1. **æ”¶é›†ä¾èµ–**ï¼šåˆ†ææ¯ä¸ªé¢„åˆ¶ä½“çš„æè´¨ã€çº¹ç†ã€Shaderã€Mesh ç­‰
2. **ç»Ÿè®¡å¼•ç”¨**ï¼šè®°å½•æ¯ä¸ªèµ„æºè¢«å¤šå°‘ä¸ªæ¨¡å‹å¼•ç”¨
3. **æ ‡è®°å…±äº«**ï¼šè¢«å¼•ç”¨ â‰¥2 æ¬¡çš„èµ„æºæ ‡è®°ä¸º `shared_common.ab`
4. **ä¼˜åŒ–åŠ è½½**ï¼šè¿è¡Œæ—¶å…ˆåŠ è½½å…±äº«åŒ…ï¼Œé¿å…èµ„æºé‡å¤

### æ„å»ºé€‰ä¸­æ¨¡å‹åŒ…çš„é€»è¾‘

```
1. ç”¨æˆ·é€‰æ‹©éƒ¨åˆ†æ¨¡å‹ï¼ˆå¦‚é€‰ä¸­ 3 ä¸ªï¼Œæœªé€‰ä¸­ 7 ä¸ªï¼‰
   â†“
2. æ‰«æ æ‰€æœ‰ 10 ä¸ªæ¨¡å‹çš„ä¾èµ–å…³ç³»
   â†“
3. æ£€æµ‹å“ªäº›èµ„æºè¢«å¤šä¸ªæ¨¡å‹å…±äº«
   â†“
4. æ ‡è®°å…±äº«èµ„æºåˆ° shared_common.ab
   â†“
5. åªæ ‡è®° é€‰ä¸­çš„ 3 ä¸ªæ¨¡å‹ è¿›è¡Œæ‰“åŒ…
   â†“
6. æ„å»ºè¾“å‡ºï¼š
   - 3 ä¸ªé€‰ä¸­çš„æ¨¡å‹ AB åŒ…
   - 1 ä¸ªå…±äº«èµ„æºåŒ…ï¼ˆå¦‚æœæœ‰ï¼‰
   - ä¸»æ¸…å•æ–‡ä»¶
```

**ä¼˜åŠ¿**ï¼šé¿å…é‡å¤æ‰“åŒ…å…±äº«èµ„æºï¼ŒèŠ‚çœåŒ…ä½“å¤§å°

---

## API æ–‡æ¡£

### AssetBundleManagerï¼ˆè¿è¡Œæ—¶ç®¡ç†å™¨ï¼‰

#### åˆå§‹åŒ–

```csharp
public IEnumerator Initialize(
    Action<AssetBundleConfigData> onInitComplete = null, 
    Action loadAllModels = null
)
```

- **åŠŸèƒ½**ï¼šåˆå§‹åŒ–ç®¡ç†å™¨ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶å’Œä¸»æ¸…å•
- **å‚æ•°**ï¼š
  - `onInitComplete`ï¼šåˆå§‹åŒ–å®Œæˆå›è°ƒï¼Œè¿”å›é…ç½®æ•°æ®
  - `loadAllModels`ï¼šæ‰€æœ‰æ¨¡å‹åŠ è½½å®Œæˆå›è°ƒ
- **è¿”å›**ï¼šIEnumeratorï¼ˆåç¨‹ï¼‰

#### åŠ è½½èµ„æºï¼ˆå¼‚æ­¥ï¼‰

```csharp
public IEnumerator LoadAssetAsync<T>(
    string bundleName, 
    string assetName, 
    Action<T> onComplete
) where T : Object
```

- **åŠŸèƒ½**ï¼šå¼‚æ­¥åŠ è½½æŒ‡å®š AB åŒ…ä¸­çš„èµ„æº
- **å‚æ•°**ï¼š
  - `bundleName`ï¼šAB åŒ…åç§°ï¼ˆå¦‚ "model_ç½.ab"ï¼‰
  - `assetName`ï¼šèµ„æºåç§°ï¼ˆå¦‚ "ç½"ï¼‰
  - `onComplete`ï¼šåŠ è½½å®Œæˆå›è°ƒï¼Œè¿”å›èµ„æºå¯¹è±¡
- **è¿”å›**ï¼šIEnumeratorï¼ˆåç¨‹ï¼‰
- **ç¤ºä¾‹**ï¼š

```csharp
yield return AssetBundleManager.Instance.LoadAssetAsync<GameObject>(
    "model_tank.ab",
    "Tank",
    (obj) => {
        if (obj != null)
        {
            Instantiate(obj);
        }
    }
);
```

#### åŠ è½½èµ„æºï¼ˆåŒæ­¥ï¼‰

```csharp
public T LoadAsset<T>(string bundleName, string assetName) where T : Object
```

- **åŠŸèƒ½**ï¼šåŒæ­¥åŠ è½½èµ„æºï¼ˆéœ€è¦ AB åŒ…å·²é¢„åŠ è½½ï¼‰
- **æ³¨æ„**ï¼šä¸æ¨èåœ¨ä¸»çº¿ç¨‹é¢‘ç¹ä½¿ç”¨ï¼Œå¯èƒ½é€ æˆå¡é¡¿

#### é¢„åŠ è½½ AB åŒ…

```csharp
public IEnumerator LoadAssetBundleAsync(
    string bundleName, 
    Action<AssetBundle> onComplete = null
)
```

- **åŠŸèƒ½**ï¼šé¢„åŠ è½½ AB åŒ…ï¼ˆä¸åŠ è½½å…·ä½“èµ„æºï¼‰
- **ç”¨é€”**ï¼šæå‰åŠ è½½å¸¸ç”¨åŒ…ï¼Œå‡å°‘åç»­åŠ è½½æ—¶é—´

#### å¸è½½ AB åŒ…

```csharp
public void UnloadAssetBundle(string bundleName, bool unloadAllLoadedObjects = false)
```

- **åŠŸèƒ½**ï¼šå¸è½½æŒ‡å®š AB åŒ…
- **å‚æ•°**ï¼š
  - `bundleName`ï¼šåŒ…åç§°
  - `unloadAllLoadedObjects`ï¼šæ˜¯å¦åŒæ—¶å¸è½½å·²å®ä¾‹åŒ–çš„å¯¹è±¡

#### å¸è½½æ‰€æœ‰ AB åŒ…

```csharp
public void UnloadAllAssetBundles(bool unloadAllLoadedObjects = false)
```

- **åŠŸèƒ½**ï¼šå¸è½½æ‰€æœ‰å·²åŠ è½½çš„ AB åŒ…
- **ç”¨é€”**ï¼šåˆ‡æ¢åœºæ™¯æ—¶é‡Šæ”¾èµ„æº

#### æ£€æŸ¥ AB åŒ…æ˜¯å¦å·²åŠ è½½

```csharp
public bool IsAssetBundleLoaded(string bundleName)
```

---

## Shader å˜ä½“ç®¡ç†

### ä»€ä¹ˆæ˜¯ Shader å˜ä½“ï¼Ÿ

Shader å˜ä½“ï¼ˆShader Variantsï¼‰æ˜¯ Unity æ ¹æ®ä¸åŒçš„å…³é”®å­—ç»„åˆç”Ÿæˆçš„ Shader ä»£ç ç‰ˆæœ¬ã€‚

#### ç¤ºä¾‹ï¼š

```shader
#pragma multi_compile DIRECTIONAL POINT SPOT
#pragma multi_compile_fog
```

ä¼šç”Ÿæˆï¼š3ï¼ˆå…‰ç…§ç±»å‹ï¼‰ Ã— 2ï¼ˆé›¾æ•ˆå¼€å…³ï¼‰ = **6 ä¸ªå˜ä½“**

### ä¸ºä»€ä¹ˆéœ€è¦ç®¡ç† Shader å˜ä½“ï¼Ÿ

âŒ **ä¸ç®¡ç†çš„åæœ**ï¼š
- è¿è¡Œæ—¶é¦–æ¬¡ä½¿ç”¨ä¼šå¡é¡¿ï¼ˆåŠ¨æ€ç¼–è¯‘ Shaderï¼‰
- WebGL ç­‰å¹³å°ä¸æ”¯æŒè¿è¡Œæ—¶ç¼–è¯‘ï¼Œæè´¨æ˜¾ç¤ºä¸ºç²‰çº¢è‰²
- æ‰“åŒ…å Shader ä¸¢å¤±

âœ… **æ­£ç¡®ç®¡ç†çš„å¥½å¤„**ï¼š
- æ‰€æœ‰å˜ä½“æå‰ç¼–è¯‘å¹¶æ‰“åŒ…
- è¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨ï¼Œæ— å¡é¡¿
- ç¡®ä¿ AB åŒ…ä¸­çš„ Shader æ­£ç¡®åŠ è½½

### æœ¬ç³»ç»Ÿçš„ Shader ç®¡ç†æ–¹æ¡ˆ

#### è‡ªåŠ¨æ£€æµ‹ä¸æ·»åŠ 

æœ¬å·¥å…·ä¼šè‡ªåŠ¨ï¼š

1. **æ‰«ææ¨¡å‹**ï¼šæ£€æµ‹æ‰€æœ‰é¢„åˆ¶ä½“ä½¿ç”¨çš„ Shader
2. **åˆ†ç±»è¯†åˆ«**ï¼š
   - è‡ªå®šä¹‰ Shaderï¼ˆéœ€è¦æ·»åŠ ï¼‰
   - Unity å†…ç½® Shaderï¼ˆStandardã€Legacy ç­‰ï¼‰
3. **æ·»åŠ åˆ°åˆ—è¡¨**ï¼šè‡ªåŠ¨æ·»åŠ åˆ° `Project Settings â†’ Graphics â†’ Always Included Shaders`
4. **æ‰“åŒ…ä¿æŠ¤**ï¼šç¡®ä¿ Shader è¢«æ­£ç¡®æ‰“åŒ…åˆ° AB åŒ…ä¸­

#### ä½¿ç”¨æ–¹æ³•

##### æ–¹æ³• 1ï¼šæ„å»ºæ—¶è‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰

1. åœ¨"Shader æ£€æµ‹ä¸ç®¡ç†"åŒºåŸŸå‹¾é€‰"æ„å»ºæ—¶è‡ªåŠ¨æ£€æµ‹ Shader"ï¼ˆé»˜è®¤å¼€å¯ï¼‰
2. ç‚¹å‡»"æ„å»ºæ‰€æœ‰æ¨¡å‹åŒ…"æˆ–"æ„å»ºé€‰ä¸­æ¨¡å‹åŒ…"
3. ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰«æå¹¶æ·»åŠ æ‰€æœ‰ Shader

##### æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ£€æµ‹

1. ç‚¹å‡»"æ£€æµ‹æ¨¡å‹ Shader"æŒ‰é’®
2. æŸ¥çœ‹ Console è¾“å‡ºçš„è¯¦ç»†æŠ¥å‘Šï¼š
   ```
   [è‡ªå®šä¹‰Shader]
     âœ“ å·²æ·»åŠ  - MyCustomShader
     âœ— æœªæ·»åŠ  - AnotherShader
   
   [å†…ç½®Shader]
     â—‹ æœªæ·»åŠ  - Standard
   ```
3. ç‚¹å‡»"è‡ªåŠ¨æ·»åŠ åˆ°åˆ—è¡¨"æŒ‰é’®
4. ç³»ç»Ÿä¼šå°†æ‰€æœ‰æ£€æµ‹åˆ°çš„ Shader æ·»åŠ åˆ° Always Included Shaders

#### Shader é¢„çƒ­ï¼ˆè¿è¡Œæ—¶ï¼‰

å¦‚æœéœ€è¦åœ¨è¿è¡Œæ—¶é¢„çƒ­ Shaderï¼Œé¿å…é¦–æ¬¡æ¸²æŸ“å¡é¡¿ï¼š

```csharp
using UnityEngine;

public class ShaderWarmup : MonoBehaviour
{
    void Start()
    {
        // é¢„çƒ­æ‰€æœ‰ Shader å˜ä½“
        Shader.WarmupAllShaders();
    }
}
```

#### ä½¿ç”¨ ShaderVariantCollectionï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦æ›´ç²¾ç»†çš„å˜ä½“æ§åˆ¶ï¼š

1. åˆ›å»º ShaderVariantCollectionï¼š
   - `Assets â†’ Create â†’ Shader Variant Collection`

2. åœ¨æ¸¸æˆè¿è¡Œæ—¶æ”¶é›†å˜ä½“ï¼š
   - `Edit â†’ Project Settings â†’ Graphics â†’ Shader Stripping â†’ Save to asset...`

3. åœ¨ä»£ç ä¸­é¢„çƒ­ï¼š
   ```csharp
   public ShaderVariantCollection shaderVariants;
   
   void Start()
   {
       shaderVariants.WarmUp();
   }
   ```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ¨¡å‹åŠ è½½åæ˜¯ç²‰çº¢è‰²ï¼Ÿ

**åŸå› **ï¼šShader æ²¡æœ‰æ­£ç¡®æ‰“åŒ…æˆ– Shader å˜ä½“ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿"æ„å»ºæ—¶è‡ªåŠ¨æ£€æµ‹ Shader"å·²å¼€å¯
2. æ‰‹åŠ¨ç‚¹å‡»"æ£€æµ‹æ¨¡å‹ Shader"æŸ¥çœ‹ç¼ºå¤±çš„ Shader
3. ç‚¹å‡»"è‡ªåŠ¨æ·»åŠ åˆ°åˆ—è¡¨"
4. é‡æ–°æ„å»º AB åŒ…

### Q2: WebGL å¹³å°åŠ è½½å¤±è´¥ï¼Ÿ

**åŸå› **ï¼šè·¯å¾„æˆ– CORS è·¨åŸŸé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ AB åŒ…åœ¨ `StreamingAssets/AssetBundles/` ç›®å½•ä¸‹
2. æ£€æŸ¥ Web æœåŠ¡å™¨çš„ CORS é…ç½®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚é”™è¯¯

### Q3: å¦‚ä½•å‡å° AB åŒ…å¤§å°ï¼Ÿ

**æ–¹æ³•**ï¼š
1. ä½¿ç”¨ Chunk å‹ç¼©ï¼ˆLZ4ï¼‰- å·²é»˜è®¤å¯ç”¨
2. å…±äº«èµ„æºè‡ªåŠ¨æ‰“åŒ… - å·²è‡ªåŠ¨å¤„ç†
3. ä½¿ç”¨çº¹ç†å‹ç¼©æ ¼å¼ï¼ˆå¦‚ ASTCã€ETC2ï¼‰
4. å‡å°‘ Shader å˜ä½“æ•°é‡ï¼ˆä½¿ç”¨ `#pragma skip_variants`ï¼‰

### Q4: æ„å»ºé€‰ä¸­æ¨¡å‹åŒ…æ—¶ï¼Œå…±äº«èµ„æºä¼šé‡å¤æ‰“åŒ…å—ï¼Ÿ

**ä¸ä¼š**ã€‚ç³»ç»Ÿä¼šï¼š
1. æ‰«ææ‰€æœ‰æ¨¡å‹ï¼ˆåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
2. æ£€æµ‹å…±äº«èµ„æº
3. åªæ‰“åŒ…ä¸€æ¬¡å…±äº«èµ„æºåˆ° `shared_common.ab`
4. é€‰ä¸­çš„æ¨¡å‹ä¼šä¾èµ–è¿™ä¸ªå…±äº«åŒ…

### Q5: å¦‚ä½•å¸è½½ä¸éœ€è¦çš„ AB åŒ…é‡Šæ”¾å†…å­˜ï¼Ÿ

```csharp
// å¸è½½å•ä¸ª AB åŒ…
AssetBundleManager.Instance.UnloadAssetBundle("model_tank.ab", false);

// å¸è½½æ‰€æœ‰ AB åŒ…ï¼ˆåˆ‡æ¢åœºæ™¯æ—¶ï¼‰
AssetBundleManager.Instance.UnloadAllAssetBundles(false);

// å¼ºåˆ¶å¸è½½ï¼ˆåŒ…æ‹¬å·²å®ä¾‹åŒ–çš„å¯¹è±¡ï¼‰
AssetBundleManager.Instance.UnloadAllAssetBundles(true);
```

### Q6: å¦‚ä½•æŸ¥çœ‹ AB åŒ…çš„ä¾èµ–å…³ç³»ï¼Ÿ

ä½¿ç”¨ AssetBundle Browserï¼ˆéœ€è¦å®‰è£…ï¼‰ï¼š
1. ç‚¹å‡»é¢æ¿ä¸­çš„"æ‰“å¼€ AB Browser"
2. æˆ–é€šè¿‡ Package Manager å®‰è£… AssetBundle Browser
3. æŸ¥çœ‹æ¯ä¸ª AB åŒ…çš„ä¾èµ–æ ‘

### Q7: æ”¯æŒçƒ­æ›´æ–°å—ï¼Ÿ

æ”¯æŒã€‚åªéœ€ï¼š
1. é‡æ–°æ„å»ºä¿®æ”¹çš„ AB åŒ…
2. ä¸Šä¼ åˆ° Web æœåŠ¡å™¨
3. å®¢æˆ·ç«¯é‡æ–°åŠ è½½å³å¯ï¼ˆæ— éœ€é‡æ–°æ‰“åŒ…æ•´ä¸ªæ¸¸æˆï¼‰

### Q8: å¦‚ä½•å¤„ç†ä¸­æ–‡æ–‡ä»¶åï¼Ÿ

ç³»ç»Ÿå·²è‡ªåŠ¨å¤„ç†ï¼š
- æ”¯æŒä¸­æ–‡æ–‡ä»¶åï¼ˆå¦‚ "ç½.prefab"ï¼‰
- é…ç½®æ–‡ä»¶ä½¿ç”¨ UTF-8 without BOM ç¼–ç 
- AB åŒ…åç§°ä¼šä¿ç•™ä¸­æ–‡

### Q9: èƒ½å¦æ‰“åŒ…åœºæ™¯ï¼ˆSceneï¼‰ï¼Ÿ

å½“å‰ç‰ˆæœ¬ä¸“æ³¨äºæ¨¡å‹å’Œèµ„æºã€‚å¦‚éœ€æ‰“åŒ…åœºæ™¯ï¼š
1. æ‰‹åŠ¨è®¾ç½®åœºæ™¯çš„ AssetBundle Name
2. ä½¿ç”¨ `BuildPipeline.BuildAssetBundles` æ‰“åŒ…
3. è¿è¡Œæ—¶ä½¿ç”¨ `SceneManager.LoadSceneAsync` åŠ è½½

---

## æ‰“åŒ…è¾“å‡ºè¯´æ˜

### è¾“å‡ºç›®å½•ç»“æ„

æ„å»ºå®Œæˆåï¼Œåœ¨ `Assets/StreamingAssets/AssetBundles/` ç›®å½•ä¸‹ä¼šç”Ÿæˆï¼š

```
AssetBundles/
â”œâ”€â”€ AssetBundles                    # ä¸»æ¸…å•æ–‡ä»¶ï¼ˆæ— æ‰©å±•åï¼‰
â”œâ”€â”€ AssetBundles.ab                 # ä¸»æ¸…å•æ–‡ä»¶ï¼ˆå¸¦ .ab åç¼€ï¼Œä¸º IIS æœåŠ¡å™¨å‡†å¤‡ï¼‰
â”œâ”€â”€ AssetBundles.manifest           # ä¸»æ¸…å•æè¿°æ–‡ä»¶ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
â”œâ”€â”€ AssetBundleConfig.json          # é…ç½®æ–‡ä»¶ï¼ˆUTF-8 ç¼–ç ï¼‰
â”œâ”€â”€ model_ç½.ab                      # æ¨¡å‹ AB åŒ…
â”œâ”€â”€ model_ç½.ab.manifest             # æ¨¡å‹åŒ…æè¿°æ–‡ä»¶
â”œâ”€â”€ model_tank.ab                   # å¦ä¸€ä¸ªæ¨¡å‹åŒ…
â”œâ”€â”€ model_tank.ab.manifest
â”œâ”€â”€ shared_common.ab                # å…±äº«èµ„æºåŒ…ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
â””â”€â”€ shared_common.ab.manifest
```

### æ–‡ä»¶è¯´æ˜

#### AssetBundlesï¼ˆä¸»æ¸…å•ï¼‰
- **ä½œç”¨**ï¼šåŒ…å«æ‰€æœ‰ AB åŒ…çš„ä¾èµ–å…³ç³»ä¿¡æ¯
- **å¿…éœ€**ï¼šæ˜¯ï¼Œè¿è¡Œæ—¶å¿…é¡»å…ˆåŠ è½½
- **ä¸¤ä¸ªç‰ˆæœ¬**ï¼š
  - `AssetBundles` - Unity æ ‡å‡†æ ¼å¼
  - `AssetBundles.ab` - å¸¦æ‰©å±•åç‰ˆæœ¬ï¼ˆè§£å†³ IIS æœåŠ¡å™¨æ— æ‰©å±•åæ–‡ä»¶ MIME ç±»å‹é—®é¢˜ï¼‰

#### AssetBundleConfig.json
```json
{
  "bundles": [
    {
      "bundleName": "model_tank.ab",
      "assetName": "Tank",
      "assetPath": "Assets/Models/Tank.prefab"
    }
  ]
}
```
- **ä½œç”¨**ï¼šè®°å½•æ‰€æœ‰æ¨¡å‹çš„æ˜ å°„å…³ç³»
- **ç¼–ç **ï¼šUTF-8 without BOMï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
- **ç”¨é€”**ï¼šè¿è¡Œæ—¶æŸ¥è¯¢ AB åŒ…åç§°å’Œèµ„æºåç§°

#### .manifest æ–‡ä»¶
- **ä½œç”¨**ï¼šäººç±»å¯è¯»çš„ AB åŒ…æè¿°æ–‡ä»¶ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
- **å†…å®¹**ï¼šCRCã€ä¾èµ–å…³ç³»ã€èµ„æºåˆ—è¡¨ç­‰
- **è¿è¡Œæ—¶**ï¼šä¸éœ€è¦ï¼Œä»…ä¾›å¼€å‘è°ƒè¯•ä½¿ç”¨

### éƒ¨ç½²åˆ° Web æœåŠ¡å™¨

#### æ–¹æ³• 1ï¼šä½¿ç”¨é¢æ¿å¤åˆ¶åŠŸèƒ½

1. åœ¨"å¤åˆ¶ AB åŒ…"åŒºåŸŸè®¾ç½®ç›®æ ‡è·¯å¾„
2. ç‚¹å‡»"å¤åˆ¶ AB åŒ…åˆ°ç›®æ ‡è·¯å¾„"
3. è‡ªåŠ¨å¤åˆ¶æ‰€æœ‰æ–‡ä»¶ï¼ˆæ’é™¤ .meta æ–‡ä»¶ï¼‰

#### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å¤åˆ¶

å°†æ•´ä¸ª `AssetBundles` æ–‡ä»¶å¤¹å¤åˆ¶åˆ° Web æœåŠ¡å™¨çš„ `StreamingAssets` ç›®å½•

#### IIS æœåŠ¡å™¨é…ç½®

å¦‚æœä½¿ç”¨ IISï¼Œéœ€è¦æ·»åŠ  MIME ç±»å‹ï¼š

```xml
<staticContent>
  <mimeMap fileExtension=".ab" mimeType="application/octet-stream" />
  <mimeMap fileExtension="." mimeType="application/octet-stream" />
</staticContent>
```

æˆ–ä½¿ç”¨å¸¦ `.ab` åç¼€çš„ä¸»æ¸…å•æ–‡ä»¶ã€‚

---

## æŠ€æœ¯ç»†èŠ‚

### WebGL å¹³å°ä¼˜åŒ–

1. **å¹¶å‘æ§åˆ¶**ï¼šé™åˆ¶åŒæ—¶åŠ è½½çš„ AB åŒ…æ•°é‡ï¼ˆé»˜è®¤ 4 ä¸ªï¼‰
2. **è¯·æ±‚é˜Ÿåˆ—**ï¼šè¶…å‡ºé™åˆ¶çš„è¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…
3. **UnityWebRequest**ï¼šä½¿ç”¨ UnityWebRequest æ›¿ä»£ WWWï¼ˆå·²åºŸå¼ƒï¼‰
4. **è·¯å¾„å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç† StreamingAssets è·¯å¾„å·®å¼‚

### ä¾èµ–ç®¡ç†

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åŠ è½½ AB åŒ…å‰å…ˆåŠ è½½å…¶ä¾èµ–åŒ…
2. å¸è½½ AB åŒ…æ—¶æ£€æŸ¥æ˜¯å¦è¢«å…¶ä»–åŒ…ä¾èµ–
3. ç»´æŠ¤å¼•ç”¨è®¡æ•°ï¼Œé¿å…é‡å¤åŠ è½½

### å†…å­˜ç®¡ç†

- **ç¼“å­˜æœºåˆ¶**ï¼šå·²åŠ è½½çš„ AB åŒ…ä¼šç¼“å­˜ï¼Œé¿å…é‡å¤åŠ è½½
- **æ‰‹åŠ¨å¸è½½**ï¼šæä¾› API æ‰‹åŠ¨å¸è½½ä¸éœ€è¦çš„ AB åŒ…
- **è‡ªåŠ¨æ¸…ç†**ï¼šåˆ‡æ¢åœºæ™¯æ—¶å¯é€‰æ‹©æ€§å¸è½½æ‰€æœ‰ AB åŒ…

---

## æœ€ä½³å®è·µ

### å¼€å‘æµç¨‹å»ºè®®

1. **å¼€å‘é˜¶æ®µ**
   - åœ¨ Unity Editor ä¸­ç›´æ¥ä½¿ç”¨ Prefab
   - æ— éœ€é¢‘ç¹æ„å»º AB åŒ…

2. **æµ‹è¯•é˜¶æ®µ**
   - æ„å»ºé€‰ä¸­çš„å‡ ä¸ªæ¨¡å‹è¿›è¡Œæµ‹è¯•
   - ä½¿ç”¨"æ„å»ºé€‰ä¸­æ¨¡å‹åŒ…"åŠŸèƒ½

3. **å‘å¸ƒé˜¶æ®µ**
   - ä½¿ç”¨"æ„å»ºæ‰€æœ‰æ¨¡å‹åŒ…"
   - å¼€å¯"æ„å»ºæ—¶è‡ªåŠ¨æ£€æµ‹ Shader"
   - ä½¿ç”¨ Chunk å‹ç¼©ï¼ˆLZ4ï¼‰

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘ AB åŒ…æ•°é‡**
   - ç›¸å…³æ¨¡å‹å¯ä»¥æ‰“åŒ…åˆ°åŒä¸€ä¸ª AB åŒ…
   - é¿å…è¿‡å¤šå°æ–‡ä»¶

2. **ä½¿ç”¨å…±äº«èµ„æºåŒ…**
   - ç³»ç»Ÿå·²è‡ªåŠ¨å¤„ç†
   - ç›¸åŒæè´¨/çº¹ç†åªåŠ è½½ä¸€æ¬¡

3. **é¢„åŠ è½½å¸¸ç”¨èµ„æº**
   ```csharp
   // åœ¨åœºæ™¯åŠ è½½æ—¶é¢„åŠ è½½
   yield return AssetBundleManager.Instance.LoadAssetBundleAsync("shared_common.ab");
   ```

4. **åŠæ—¶å¸è½½ä¸éœ€è¦çš„èµ„æº**
   ```csharp
   // åˆ‡æ¢åœºæ™¯æ—¶
   AssetBundleManager.Instance.UnloadAllAssetBundles(false);
   ```

### ç›®å½•ç»„ç»‡å»ºè®®

```
Assets/
â”œâ”€â”€ Models/                    # æ‰€æœ‰æ¨¡å‹ Prefab
â”‚   â”œâ”€â”€ Characters/           # è§’è‰²æ¨¡å‹
â”‚   â”œâ”€â”€ Props/                # é“å…·æ¨¡å‹
â”‚   â””â”€â”€ Environment/          # ç¯å¢ƒæ¨¡å‹
â”œâ”€â”€ Materials/                # æè´¨
â”œâ”€â”€ Textures/                 # çº¹ç†
â”œâ”€â”€ Shaders/                  # è‡ªå®šä¹‰ Shader
â””â”€â”€ StreamingAssets/
    â””â”€â”€ AssetBundles/         # æ„å»ºè¾“å‡ºç›®å½•
```

---

## ç‰ˆæœ¬å†å²

### v1.0.0ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- âœ… å¯è§†åŒ–æ‰“åŒ…å·¥å…·é¢æ¿
- âœ… æ¨¡å‹é€‰æ‹©æ‰“åŒ…åŠŸèƒ½
- âœ… Shader è‡ªåŠ¨æ£€æµ‹ä¸ç®¡ç†
- âœ… å…±äº«èµ„æºæ™ºèƒ½å¤„ç†
- âœ… WebGL å¹³å°é€‚é…
- âœ… è¿è¡Œæ—¶åŠ è½½ç®¡ç†å™¨
- âœ… é…ç½®æŒä¹…åŒ–
- âœ… å®Œæ•´çš„ä¾èµ–ç®¡ç†

---

## å‚è€ƒèµ„æº

### Unity å®˜æ–¹æ–‡æ¡£
- [AssetBundles ä»‹ç»](https://docs.unity3d.com/Manual/AssetBundlesIntro.html)
- [AssetBundle å·¥ä½œæµç¨‹](https://docs.unity3d.com/Manual/AssetBundleWorkflow.html)
- [Shader å˜ä½“](https://docs.unity3d.com/Manual/shader-variants.html)

### ç›¸å…³å·¥å…·
- [AssetBundle Browser](https://docs.unity3d.com/Packages/com.unity.assetbundlebrowser@1.7/manual/index.html) - AB åŒ…å¯è§†åŒ–æŸ¥çœ‹å·¥å…·
- [Addressables](https://docs.unity3d.com/Packages/com.unity.addressables@latest) - Unity çš„é«˜çº§èµ„æºç®¡ç†ç³»ç»Ÿ

---

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼š
- æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
- æŸ¥çœ‹ Unity å®˜æ–¹æ–‡æ¡£
- æ£€æŸ¥ Console æ—¥å¿—è¾“å‡º

---

**Happy Bundling! ğŸš€**
